#!/bin/env bash

set -e
source helpers/array_values

echo "$LB_GET_VALUES" | while read _VALUE_STRING; do
    [ -z "$_VALUE_STRING" ] && continue

    echo ${_VALUE_STRING} | {
        read _VALUE_NAME _VALUE_TEST
        echo "echo -n '$LB_RUNDATE-logbuster values $_VALUE_NAME'"

        [ -v "lb_values[$_VALUE_NAME]" ] && {
            echo "_value_result=\$(lb_test_result ${lb_values[$_VALUE_NAME]})"
            echo "if [ \$_value_result == _lb_error ]; then"
            echo "echo ' error'; else"
            [ -z "$_VALUE_TEST" ] && {
                echo "echo ' ok'"
            } || {
                echo "if [ \"\$_value_result\" $_VALUE_TEST ]; then echo ' ok'; else echo ' warn'; fi"
            }
            echo "echo \"\$_value_result\"; fi"
        } || {
            echo "_value_result=\$(lb_test_result $_VALUE_TEST)"
            echo "if [ \"\$_value_result\" == _lb_error ]; then"
            echo "echo ' warn_custom'; else echo ' ok'; echo \"\$_value_result\"; fi"
        }
    }
done
